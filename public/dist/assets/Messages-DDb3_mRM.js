import{w as _,a as T,r as g,ao as L,j as s,A as h,L as D,ap as $,aq as k}from"./main-DA-vLYwL.js";import{B as U}from"./Button-eyYpVHNH.js";import{U as q}from"./user-round-B_V6w1XN.js";import{S as B}from"./Searchbar-Dj_QCDtm.js";import"./cn-DUyS5Z8L.js";import"./createLucideIcon-yfTUF5RS.js";const G=({data:i})=>{var p;const l=_(e=>e.auth.user),c=T(),n=(l==null?void 0:l.accountType)==="influencer",[o,t]=g.useState([]),{data:a,isLoading:r}=L(),x=Array.isArray(i)?i.map(e=>{var d;return{lastMessage:e.lastMessage,sender:(l==null?void 0:l._id)===((d=e==null?void 0:e.userDetails)==null?void 0:d._id)?e.lastMessage.senderDetails:e.userDetails}}):[],v=x.map(e=>{var d;return(d=e==null?void 0:e.sender)==null?void 0:d._id}),j=((p=a==null?void 0:a.sponsorships)==null?void 0:p.map(e=>{if(n&&!v.includes(e.brandId._id))return{lastMessage:{content:`Sponsorship request from ${e.brandId.fullName}`,senderDetails:e.brandId,createdAt:e.createdAt},sender:{fullName:e.brandId.fullName,_id:e.brandId._id}};if(!n&&!v.includes(e.influencerId._id))return{lastMessage:{content:`Sponsorship request to ${e.influencerId.fullName}`,senderDetails:e.brandId,createdAt:e.createdAt},sender:{fullName:e.influencerId.fullName,avatar:e.influencerId.avatar,_id:e.influencerId._id}}}).filter(e=>e))||[];return g.useEffect(()=>{const e=[...j,...x].sort((d,m)=>new Date(m.lastMessage.createdAt)-new Date(d.lastMessage.createdAt)).filter((d,m,f)=>m===f.findIndex(u=>u.sender._id===d.sender._id));JSON.stringify(e)!==JSON.stringify(o)&&t(e)},[j,x,o]),r?s.jsx(h,{}):s.jsx("div",{className:"mt-6 md:h-[54vh] h-[66vh] overflow-y-auto scrollbar-custom",children:o.length===0?s.jsx("div",{className:"grid place-items-center",children:s.jsxs("div",{className:"text-center mt-8",children:[s.jsx("img",{src:"/images/no-message.svg",alt:"no-message",className:"mx-auto"}),s.jsx("p",{className:"mt-6 mb-1 text-xl font-semibold",children:"Thus far, no messages have arrived"}),s.jsx("p",{children:"Start a fresh conversation"}),s.jsx(U,{onClick:()=>{(l==null?void 0:l.accountType)==="brand"?c("/brands/explore"):c("/explore",{state:{activeTab:2}})},className:"mt-4 px-4 py-2",children:(l==null?void 0:l.accountType)!=="brand"?"Explore Brands":"Explore Influencers"})]})}):s.jsx("div",{className:"flex flex-col gap-3 mr-3",children:o.map((e,d)=>{var m,f,u,b,N,y,w,M,I,S,A;return s.jsx(D,{to:(l==null?void 0:l.accountType)==="brand"?`/brands/messages/${(m=e==null?void 0:e.sender)==null?void 0:m._id}`:`/messages/${(f=e==null?void 0:e.sender)==null?void 0:f._id}`,children:s.jsxs("div",{className:"flex justify-between items-center hover:bg-blue-lighter py-2 px-4 rounded-md transition",children:[s.jsxs("div",{className:"flex gap-3 items-center",children:[s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-300",children:(u=e==null?void 0:e.sender)!=null&&u.avatar?s.jsx("img",{src:((b=e==null?void 0:e.sender)==null?void 0:b.avatar)||"/images/default-avatar.png",className:"w-full h-full object-cover",alt:`${((N=e==null?void 0:e.sender)==null?void 0:N.fullName)||"User"}'s avatar`,onError:E=>{E.target.src="/images/default-avatar.png"}}):s.jsx("div",{className:"w-full h-full rounded-full flex items-center justify-center",children:s.jsx(q,{className:"text-black w-12 h-12"})})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-lg b-1",children:((w=(y=e==null?void 0:e.sender)==null?void 0:y.fullName)==null?void 0:w.charAt(0).toUpperCase())+((I=(M=e==null?void 0:e.sender)==null?void 0:M.fullName)==null?void 0:I.slice(1))}),s.jsx("p",{className:"text-xs font-medium",children:(S=e==null?void 0:e.lastMessage)==null?void 0:S.content})]})]}),s.jsx("p",{className:"font-semibold text-sm",children:new Date((A=e==null?void 0:e.lastMessage)==null?void 0:A.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]})},d)})})})},Q=({unreadMessages:i,allChats:l})=>{const c=T(),n=_(a=>a.auth.user),o=l==null?void 0:l.map(a=>{var r;return{lastMessage:a.lastMessage,sender:(n==null?void 0:n._id)===((r=a==null?void 0:a.userDetails)==null?void 0:r._id)?a.lastMessage.senderDetails:a.userDetails}}),t=i==null?void 0:i.map(a=>{var r;return{lastMessage:a,sender:(r=o.find(x=>x.sender._id===a.senderId))==null?void 0:r.sender}});return s.jsx("div",{className:"mt-6 md:h-[54vh] h-[66vh] overflow-y-auto scrollbar-custom",children:(t==null?void 0:t.length)===0?s.jsx("div",{className:"grid place-items-center",children:s.jsxs("div",{className:"text-center mt-8",children:[s.jsx("img",{src:"/images/no-message.svg",alt:"no-message",className:"mx-auto"}),s.jsx("p",{className:"mt-6 mb-1 text-xl font-semibold",children:"Thus far, no messages have arrived"}),s.jsx("p",{children:"Start a fresh conversation"}),s.jsx(U,{className:"mt-4 px-4 py-2",onClick:()=>{(n==null?void 0:n.accountType)==="brand"?c("/brands/explore"):c("/explore",{state:{activeTab:1}})},children:(n==null?void 0:n.accountType)==="brand"?"Explore Influencers":"Explore Brands"})]})}):s.jsx("div",{className:"flex flex-col gap-3 mr-3",children:t==null?void 0:t.map((a,r)=>s.jsx(D,{to:(n==null?void 0:n.accountType)==="brand"?`/brands/messages/${a.sender._id}`:`/messages/${a.sender._id}`,children:s.jsxs("div",{className:"flex justify-between items-center hover:bg-blue-lighter py-2 px-4 rounded-md transition",children:[s.jsxs("div",{className:"flex gap-3 items-center",children:[s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-blue-lighter",children:s.jsx("img",{src:"",className:"w-full h-full",alt:""})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-lg b-1",children:a.sender.fullName.charAt(0).toUpperCase()+a.sender.fullName.slice(1)}),s.jsx("p",{className:"text-xs font-medium",children:a.lastMessage.content})]})]}),s.jsx("p",{className:"font-semibold text-sm",children:new Date(a.lastMessage.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]})},r))})})},F=()=>{const{data:i,isLoading:l}=$(),{data:c}=k(),n=i,[o,t]=g.useState(0),[a,r]=g.useState("");return l?s.jsx(h,{}):s.jsx("div",{className:"flex flex-col gap-4 bg-background-alt rounded-lg px-4 md:px-6 p-1",children:s.jsxs("div",{className:"my-4",children:[s.jsx("div",{className:"mb-4 md:w-1/4 w-3/4",children:s.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Messages"})}),s.jsx("div",{children:s.jsx(B,{searchText:a,setSearchText:r,className:"w-full rounded-3xl"})}),o===0?s.jsx(G,{data:c}):s.jsx(Q,{unreadMessages:n,allChats:c})]})})};export{F as default};
