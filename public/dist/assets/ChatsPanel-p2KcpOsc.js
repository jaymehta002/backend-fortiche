import{j as e,r as g,ar as K,as as W,at as q,au as V,x as Z,A as P,_ as p,av as k,g as J,w as X,a as Y,aw as ee,ax as se,ay as te,az as ae}from"./main-DA-vLYwL.js";import{B as u}from"./Button-eyYpVHNH.js";import{P as re}from"./plus-CXLEFkyt.js";import{R as Q}from"./index-BdrbOg9j.js";import{I as ne}from"./Input-Da7NVINN.js";import{M as oe}from"./Modal-DmDqMwFG.js";import{c as U}from"./createLucideIcon-yfTUF5RS.js";/* empty css                     */import"./cn-DUyS5Z8L.js";/**
 * @license lucide-react v0.436.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=U("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.436.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=U("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]),ie=({...s})=>e.jsx("svg",{...s,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 122.56 122.88",fill:"#ebecec80",stroke:"#ebecec80",children:e.jsx("path",{d:"M2.33,44.58,117.33.37a3.63,3.63,0,0,1,5,4.56l-44,115.61h0a3.63,3.63,0,0,1-6.67.28L53.93,84.14,89.12,33.77,38.85,68.86,2.06,51.24a3.63,3.63,0,0,1,.27-6.66Z"})}),de=({className:s,receiverId:t,setIsSelectProductModalOpen:o,isInfluencer:m,...c})=>{const[n,i]=g.useState(""),[y]=K(),b=x=>{i(x.target.value)},h=async x=>{x.preventDefault();try{await y({content:n,receiver:t}),i("")}catch(N){console.log(N)}},j=x=>{x.key==="Enter"&&h(x)};return e.jsxs("div",{className:"flex gap-3 items-center bg-white p-3 rounded-lg shadow-sm border border-gray-200",children:[!m&&e.jsx(u,{className:"w-10 h-10 rounded-full grid place-items-center bg-green-50 hover:bg-green-100 transition-colors duration-200",onClickHandler:()=>o(!0),children:e.jsx(re,{className:"w-5 h-5 text-green-600"})}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"text",...c,value:n,onChange:b,onKeyDown:j,className:"w-full px-4 py-2.5 rounded-full bg-gray-50 border border-gray-200 focus:border-green-500 focus:ring-1 focus:ring-green-500 outline-none text-gray-700 placeholder-gray-400"})}),e.jsx(u,{className:`w-10 h-10 rounded-full grid place-items-center transition-all duration-200 ${n?"bg-green-600 hover:bg-green-700":"bg-gray-100 cursor-not-allowed"}`,onClick:h,disabled:!n,children:e.jsx(ie,{className:`w-5 h-5 ${n?"fill-white":"fill-gray-400"} transition-colors duration-200`})})]})},me=s=>{let t=s.getHours(),o=s.getMinutes();const m=t>=12?"pm":"am";return t%=12,t=t||12,o=o<10?`0${o}`:o,`${t}:${o} ${m}`},xe=({chatData:s,isUserMessage:t})=>{const o=me(new Date(s.createdAt));return e.jsx("div",{className:`max-w-[70%] w-fit ${t?"bg-green-600 text-white self-end rounded-l-2xl rounded-tr-2xl":"bg-gray-100 text-gray-800 self-start rounded-r-2xl rounded-tl-2xl"} px-4 py-3 shadow-sm hover:shadow-md transition-shadow duration-200`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{value:s.content,readOnly:!0,theme:null,className:`text-[15px] leading-relaxed ${t?"text-white":"text-gray-800"}`}),e.jsxs("div",{className:`flex items-center gap-2 ${t?"justify-end":"justify-start"}`,children:[e.jsx("span",{className:`text-xs ${t?"text-green-100":"text-gray-500"}`,children:o}),t&&e.jsx("svg",{className:"w-4 h-4 text-green-100",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})})]})]})})},he=({isOpen:s,onClose:t,influencerId:o})=>{var D,B,E,F;const{data:m,isLoading:c}=W(),[n,i]=g.useState([]),[y,{isLoading:b}]=q(),[h,{isLoading:j}]=V(),[x,N]=g.useState(!0),v=(m==null?void 0:m.products)||[],{data:l,isLoading:A,isError:M}=Z({influencerId:o}),[f,a]=g.useState(""),[d,L]=g.useState(!1),[I,w]=g.useState(""),z=r=>{w(""),i([r._id]),a("")},G=()=>{if(n.length===0){w("Please select a product first");return}const r=Number(f);if(!f||isNaN(r)){w("Please enter a valid amount");return}if(r<=0){w("Amount must be greater than 0");return}w(""),L(!0)},$=async()=>{var r,H,R,O;try{p.loading("Creating your sponsorship...",{id:"sponsorship"});const C=await y({influencerId:o,productId:n,amount:f});if(C){p.loading("Preparing secure payment gateway...",{id:"sponsorship"});const S=await h({sponsorshipId:(H=(r=C==null?void 0:C.data)==null?void 0:r.sponsorship)==null?void 0:H._id});(R=S==null?void 0:S.data)!=null&&R.url&&(p.success("Redirecting to payment gateway...",{id:"sponsorship"}),window.location.href=(O=S==null?void 0:S.data)==null?void 0:O.url)}t(),N(!0),i([])}catch(C){p.error("Unable to process sponsorship. Please try again later.",{id:"sponsorship",duration:5e3}),console.error("Failed to create sponsorship:",C)}},T=()=>{t(),N(!0),i([])},_=()=>{L(!1)};return s?b||j?e.jsx(P,{}):e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50",children:e.jsx(oe,{onClose:T,children:d?e.jsxs("div",{className:"p-8 rounded-xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Confirm Sponsorship Details"}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg mb-6",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-green-100",children:[e.jsxs("p",{className:"text-lg font-medium text-gray-800 flex items-center justify-between",children:[e.jsx("span",{children:"Sponsorship Amount:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["€",f]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2 flex items-center justify-between",children:[e.jsx("span",{children:"Duration:"}),e.jsxs("span",{className:"font-medium",children:[(D=l==null?void 0:l.terms)==null?void 0:D.duration," months"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:"Selected Products:"}),e.jsx("div",{className:"bg-white p-4 rounded-md",children:v.filter(r=>n.includes(r._id)).map(r=>e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("img",{src:r.imageUrls[0]||"/api/placeholder/200/200",alt:r.title,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:r.title}),e.jsx("p",{className:"text-sm text-gray-500",children:r.category})]})]},r._id))})]}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:"Terms Summary:"}),e.jsx("div",{className:"bg-white p-4 rounded-md",children:e.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap break-words",children:(B=l==null?void 0:l.terms)==null?void 0:B.termsAndConditions})})]})]}),e.jsxs("div",{className:"flex w-full justify-end gap-3 mt-6",children:[e.jsx(u,{variant:"outline",onClick:_,className:"px-6 py-2 hover:bg-gray-100 rounded-md",children:"Back"}),e.jsxs(u,{className:"px-6 py-2  rounded-md flex items-center gap-2 whitespace-nowrap",onClick:$,children:[e.jsx("span",{children:"Proceed to Payment"}),e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})]})]}):x?e.jsxs("div",{className:"p-8  max-h-[85vh] overflow-y-auto bg-white rounded-xl w-full max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-800",children:"Select Product for Sponsorship"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Choose one product from your catalog to create a sponsorship campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"amount",className:"text-base font-semibold text-gray-900",children:"Sponsorship Amount"}),n.length===0&&e.jsx("span",{className:"text-amber-600 text-xs font-medium bg-amber-50 px-2 py-1 rounded-md",children:"Select a product to proceed"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:e.jsx(ce,{className:"h-4 w-4 text-gray-500"})}),e.jsx(ne,{type:"number",value:f,placeholder:"0.00",id:"amount",className:`pl-9 pr-4 h-11 text-lg rounded-md ${I?"border-red-500 focus:ring-red-500":"focus:ring-blue-500"}`,onChange:r=>{w(""),a(r.target.value)},disabled:n.length===0})]}),I&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:I})]})]}),c?e.jsxs("div",{className:"flex flex-col items-center py-12",children:[e.jsx(P,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your products..."})]}):v.length===0?e.jsxs("div",{className:"text-center  py-12 bg-gray-50 rounded-lg",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"text-gray-700 font-medium",children:"No Products Available"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Please add products to your catalog before creating a sponsorship"})]}):e.jsx("div",{className:"grid grid-cols-1 mt-4 md:grid-cols-2 gap-4",children:v.map(r=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all duration-200 ${n.includes(r._id)?"border-blue-500 bg-blue-50 shadow-md":"hover:bg-gray-50"}`,onClick:()=>z(r),children:[e.jsx("img",{src:r.imageUrls[0]||"/api/placeholder/200/200",alt:r.title,className:"w-full h-40 object-cover mb-2"}),e.jsx("h3",{className:"font-semibold",children:r.title}),e.jsx("p",{className:"text-sm text-gray-500",children:r.category})]},r._id))}),e.jsxs("div",{className:"flex w-full justify-end mt-4",children:[e.jsx(u,{variant:"outline",onClick:T,className:"p-2",children:"Cancel"}),e.jsx(u,{className:"px-4 py-1 ml-2 rounded-md",onClick:G,disabled:n.length===0,children:"Continue"})]})]}):A?e.jsx(P,{}):M?e.jsx("div",{className:"p-12 bg-white rounded-xl",children:e.jsx("p",{className:"text-lg font-semibold p-4",children:e.jsx("strong",{children:"No terms and conditions found"})})}):e.jsxs("div",{className:"min-w-[300px] w-full max-w-[400px] p-6 max-h-[80vh] overflow-y-auto bg-white rounded-xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Terms and Conditions"}),e.jsx("p",{className:"whitespace-pre-wrap mb-4",children:e.jsx("strong",{children:(E=l==null?void 0:l.terms)==null?void 0:E.termsAndConditions})}),e.jsxs("p",{className:"mb-4",children:["Duration: ",e.jsxs("strong",{children:[(F=l==null?void 0:l.terms)==null?void 0:F.duration," months"]})]}),e.jsxs("div",{className:"flex w-full justify-end",children:[e.jsx(u,{variant:"outline",onClick:_,className:"p-2",children:"Back"}),e.jsx(u,{className:"px-4 py-1 ml-2",onClick:$,disabled:n.length===0,children:"Continue to Payment"})]})]})})}):null},pe=({item:s,isInfluencer:t,onApprove:o,onReject:m})=>{const[c,n]=g.useState(!1),i=async h=>{n(!0);try{await o(h),k.success("Sponsorship approved successfully")}catch(j){k.error(j.message||"Failed to approve sponsorship")}finally{n(!1)}},y=async h=>{n(!0);try{await m(h),k.success("Sponsorship rejected")}catch(j){k.error(j.message||"Failed to reject sponsorship")}finally{n(!1)}},b=`
    max-w-[80%] w-fit bg-white border rounded-xl shadow-sm transition-shadow duration-200 overflow-hidden
    ${t?"self-start":"self-end"}
    ${s.content.status==="rejected"?"opacity-75 border-gray-300":"border-gray-200 hover:shadow-md"}
  `;return e.jsxs("div",{className:b,children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:s.content.productId.imageUrls[0],alt:s.content.productId.title,className:"w-24 h-24 object-cover rounded-lg shadow-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:s.content.productId.title}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Category:"})," ",s.content.productId.category]}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",s.content.duration]}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Amount:"})," ",e.jsxs("span",{className:"text-green-600 font-semibold",children:["€",s.content.amount]})]}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",e.jsx("span",{className:`font-semibold ${s.content.status==="approved"?"text-green-600":s.content.status==="rejected"?"text-red-600":"text-amber-600"}`,children:s.content.status.charAt(0).toUpperCase()+s.content.status.slice(1)})]})]})]})]})}),e.jsx("div",{className:"p-4 bg-white",children:e.jsx(Q,{value:s.content.productId.description,readOnly:!0,theme:"bubble",className:"text-gray-700 text-sm"})}),s.content.status==="pending"&&t&&e.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-100 flex gap-3",children:[e.jsx("button",{onClick:()=>i(s.content._id),disabled:c,className:`
              flex-1 px-4 py-2 rounded-lg transition-colors duration-200
              ${c?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} text-white
            `,children:c?"Processing...":"Approve"}),e.jsx("button",{onClick:()=>y(s.content._id),disabled:c,className:`
              flex-1 px-4 py-2 rounded-lg transition-colors duration-200 border
              ${c?"border-gray-400 text-gray-400 cursor-not-allowed":"border-red-600 text-red-600 hover:bg-red-50"}
            `,children:c?"Processing...":"Reject"})]})]})},Ce=()=>{var f;const{id:s}=J(),t=X(a=>a.auth.user),o=Y(),[m]=ee(),{data:c,isLoading:n}=se(s),i=(t==null?void 0:t.accountType)==="influencer",y=i?t._id:s,b=i?s:t._id,[h,{isLoading:j}]=te(),{data:x}=ae({influencerId:y,brandId:b}),[N,v]=g.useState(!1);if(g.useEffect(()=>{(async()=>{await m(s)})()},[s,m]),n)return e.jsx(P,{});const l=[...c.map(a=>({type:"chat",content:a,timestamp:new Date(a.createdAt).getTime()})),...((f=x==null?void 0:x.sponsorships)==null?void 0:f.map(a=>({type:"sponsorship",content:a,timestamp:new Date(a.createdAt).getTime()})))||[]];l.sort((a,d)=>a.timestamp-d.timestamp);const A=async a=>{try{const d=await h({sponsorshipId:a,status:"approved"});d.data?p.success("Product has been added to profile. Made payment successfully.Made with love on fortiche"):p.error(d.error.data.message||"Failed to approve sponsorship")}catch(d){p.error(d.message||"An error occurred while approving sponsorship")}},M=async a=>{try{const d=await h({sponsorshipId:a,status:"rejected"});d.data?p.success("Sponsorship rejected successfully"):p.error(d.error.data.message||"Failed to reject sponsorship")}catch(d){p.error(d.message||"An error occurred while rejecting sponsorship")}};return e.jsxs(e.Fragment,{children:[e.jsx(he,{influencerId:s,isOpen:N,onClose:()=>v(!1)}),e.jsxs("div",{className:"bg-[#fff] py-3 rounded-lg h-[90vh] md:h-[82vh] flex flex-col justify-between mt-4",children:[e.jsxs("div",{className:"flex gap-5 items-center w-full px-4 mb-2",children:[e.jsx(u,{className:"w-10 h-10 grid place-items-center pb-1.5 md:pb-1 text-2xl font-semibold",onClickHandler:()=>o(-1),children:"←"}),e.jsx("h2",{className:"text-3xl font-bold",children:"Messages"})]}),e.jsx("div",{className:"h-[75vh] md:h-[70vh] overflow-y-auto scrollbar-custom px-2 md:px-8 mt-2 mb-3",children:e.jsx("div",{className:"flex flex-col gap-4",children:l.map(a=>a.type==="chat"?e.jsx(xe,{chatData:a.content,isUserMessage:a.content.senderId!==s},a.content._id):a.type==="sponsorship"?e.jsx(pe,{item:a,isInfluencer:i,onApprove:A,onReject:M},a.content._id):null)})}),e.jsx("div",{className:"px-4",children:e.jsx(de,{className:"text-body-700 px-4 placeholder:text-body-300",receiverId:s,placeholder:"Type Message here...",setIsSelectProductModalOpen:v,isInfluencer:i})})]})]})};export{Ce as default};
