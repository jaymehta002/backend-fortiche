import{be as D,r as c,j as e,_ as n,bf as F,bg as O,bh as U}from"./main-DA-vLYwL.js";import{M}from"./Modal-DmDqMwFG.js";const V=({onClose:m})=>{const[N]=D(),x=()=>{const r=new Date;return r.setDate(r.getDate()+1),r.toISOString().split("T")[0]},[s,o]=c.useState({couponName:"",totalUsageLimit:null,expiry:x(),applyTo:[],discountType:"",discountAmount:"",minimumOrderValue:"",isActive:!0}),d=r=>{const{name:a,value:i,type:p,checked:u}=r.target;if(p==="checkbox")if(a==="isActive")o({...s,isActive:u});else{const h=s.applyTo.includes(i)?s.applyTo.filter(g=>g!==i):[...s.applyTo,i];o({...s,applyTo:h})}else o(a==="condition"||a==="minimumPurchase"?{...s,activateCondition:{...s.activateCondition,[a]:i}}:{...s,[a]:i})},v=async()=>{var r;try{if(!s.couponName.trim()){n.error("Coupon name is required");return}if(s.couponName.length>100){n.error("Coupon name cannot exceed 100 characters");return}if(!Number.isInteger(s.totalUsageLimit)||s.totalUsageLimit<=0){n.error("Usage limit must be a positive integer");return}const a=parseFloat(s.discountAmount);if(isNaN(a)||a<0){n.error("Discount amount must be a non-negative number");return}if(s.discountType==="Percentage"&&a>100){n.error("Percentage discount cannot exceed 100%");return}const i={Percentage:"PERCENTAGE",FixedAmount:"AMOUNT"},p={Subtotal:"SUBTOTAL",DELIVERY:"DELIVERY"},u=s.applyTo.map(j=>p[j]),h=parseFloat(s.minimumOrderValue);if(isNaN(h)||h<0){n.error("Minimum order value must be a non-negative number");return}const g=await N({name:s.couponName,usageLimit:s.totalUsageLimit,applyTo:u,discountType:i[s.discountType],discountAmount:parseFloat(s.discountAmount),expiry:s.expiry,cumulative:s.isActive,minimumOrderValue:parseFloat(s.minimumOrderValue)}).unwrap();g.error&&n.error(g.error),n.success("Coupon created successfully"),m()}catch(a){console.error("Error saving coupon:",a);const i=((r=a.data)==null?void 0:r.message)||a.message||"Failed to create coupon";n.error(i)}};return e.jsxs("div",{className:"p-6 min-h-screen ",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("button",{className:"mr-4",onClick:m,children:e.jsx("img",{src:"/icons/back_button.svg",alt:"back"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Add Coupons"})]}),e.jsx("div",{children:e.jsx("button",{className:"bg-green-500 text-white rounded-3xl px-4 py-2",onClick:v,children:"Save and Continue"})})]}),e.jsxs("div",{className:"md:w-2/3",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Name"}),e.jsx("input",{name:"couponName",value:s.couponName,onChange:d,className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4",placeholder:"Coupon name"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Total Usage Limit"}),e.jsx("input",{type:"number",name:"totalUsageLimit",value:s.totalUsageLimit,onChange:r=>{const a=parseInt(r.target.value,10);o({...s,totalUsageLimit:a>0?a:null})},className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4",placeholder:"Enter total usage limit"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Expires"}),e.jsx("input",{type:"date",name:"expiry",value:s.expiry,onChange:d,min:new Date().toISOString().split("T")[0],className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Apply To"}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-start space-x-3 py-2",children:[e.jsx("input",{type:"checkbox",className:"accent-green-500 w-5 h-5",value:"Subtotal",checked:s.applyTo.includes("Subtotal"),onChange:d}),e.jsxs("span",{className:"font-bold text-base",children:["Subtotal",e.jsx("p",{className:"text-sm text-gray-400 font-normal",children:"Applied to the order subtotal. Coupon does not show in product pages."})]})]})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-start space-x-3 py-2",children:[e.jsx("input",{type:"checkbox",className:"accent-green-500 w-5 h-5",value:"DELIVERY",checked:s.applyTo.includes("DELIVERY"),onChange:d}),e.jsxs("span",{className:"font-bold text-base",children:["Delivery",e.jsx("p",{className:"text-sm text-gray-400 font-normal",children:"Applies to order shipping costs. Applicable countries and regions can be specified."})]})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-bold text-lg py-2 ",children:"DISCOUNT"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block mb-2",children:"Type of"}),e.jsxs("select",{name:"discountType",value:s.discountType,onChange:d,className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4",children:[e.jsx("option",{value:"",children:"Select discount type"}),e.jsx("option",{value:"Percentage",children:"Percentage"}),e.jsx("option",{value:"FixedAmount",children:"Fixed Amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Value"}),e.jsx("input",{name:"discountAmount",value:s.discountAmount,onChange:d,className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4",placeholder:"Discount amount"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Minimum Order Value"}),e.jsx("input",{type:"number",name:"minimumOrderValue",value:s.minimumOrderValue,onChange:d,className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4",placeholder:"Enter minimum order value"})]})]})]})},P=()=>{const[m,N]=c.useState(""),{data:x}=F(),[s,o]=c.useState([]),[d]=O(),[v,r]=c.useState(!1),[a]=U(),[i,p]=c.useState(!1),[u,h]=c.useState(null);c.useEffect(()=>{x&&o(x==null?void 0:x.data)},[x]);const g=t=>{o([...s,t])},[j,C]=c.useState([]),[f,w]=c.useState(!1);c.useEffect(()=>{k()},[m]),c.useEffect(()=>{C(s)},[s]);const k=()=>{let t=[...s];m==="by discount"?t.sort((l,b)=>parseFloat(b.discount.amount)-parseFloat(l.discount.amount)):m==="Usage Limit"?t.sort((l,b)=>parseFloat(b.usageLimit)-parseFloat(l.usageLimit)):m==="condition"&&t.sort((l,b)=>l.applyTo.localeCompare(b.applyTo)),C(t)},A=t=>{N(t.target.value)},T=()=>{w(!f);const t=s.map(l=>({...l,isActive:!f}));o(t)},E=async t=>{try{const l=s.map(y=>y._id===t?{...y,isActive:!y.isActive}:y);o(l);const b=l.find(y=>y._id===t);await d({id:t,coupon:b}),n.success("Coupon updated successfully")}catch{n.error("Error updating coupon")}},S=t=>{h(t),p(!0)},L=async()=>{try{(await a(u._id)).data.success?(o(s.filter(l=>l._id!==u._id)),n.success("Coupon deleted successfully")):n.error("Error deleting coupon")}catch{n.error("Error deleting coupon")}finally{p(!1),h(null)}};return e.jsxs("div",{className:"p-6 bg-[#f5fffa] min-h-screen",children:[v?e.jsx(V,{onSave:g,onClose:()=>r(!1)}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Coupons"}),e.jsx("div",{className:"flex justify-end items-center mb-6",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("select",{value:m,onChange:A,className:"p-2 border border-[#E4FFF0] font-medium text-sm rounded-3xl focus:outline-none focus:ring-2 focus:ring-white",children:[e.jsx("option",{value:"",children:"Filter "}),e.jsx("option",{value:"by discount",children:"By discount"}),e.jsx("option",{value:"Usage Limit",children:"Usage Limit"}),e.jsx("option",{value:"condition",children:"Condition"})]}),e.jsx("button",{className:"px-4 py-2 bg-green-500 font-medium text-sm text-white-pure rounded-3xl",onClick:()=>r(!0),children:"+ Create New"})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"border-b-2 border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:f,onChange:T}),e.jsx("div",{className:`${f?"bg-green-500":"bg-gray-600"} w-10 h-6 rounded-full p-1 flex items-center transition-all duration-300`,children:e.jsx("div",{className:`bg-white w-4 h-4 rounded-full shadow-md transform transition-transform duration-300 ${f?"translate-x-4":""}`})})]})})}),e.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Coupon Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Usage Limit"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Usage"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Discount"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Actions"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Condition"})]})}),e.jsx("tbody",{children:j.map(t=>e.jsxs("tr",{className:"hover:bg-gray-100 bg-[#f5fffa]",children:[e.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:t.isActive,onChange:()=>E(t._id)}),e.jsx("div",{className:`${t.isActive?"bg-green-500":"bg-gray-600"} w-10 h-6 rounded-full p-1 flex items-center transition-all duration-300`,children:e.jsx("div",{className:`bg-white w-4 h-4 rounded-full shadow-md transform transition-transform duration-300 ${t.isActive?"translate-x-4":""}`})})]})})}),e.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("div",{children:e.jsx("p",{className:"font-bold pb-1 text-base",children:t.name})})}),e.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:t.name}),e.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:t.usageLimit}),e.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:t.usage}),e.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:t.discount.type==="PERCENTAGE"?`${t.discount.amount}%`:`${t.discount.amount}€`}),e.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("button",{onClick:()=>S(t),className:"text-red-600 hover:text-red-800 font-medium",children:"Delete"})}),e.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("span",{className:"px-2 py-1 bg-green-100 rounded text-sm",children:t.applyTo.join(",")})})]},t._id))})]})})," "]}),j.length===0&&e.jsx("div",{className:"text-center text-gray-500 col-span-4 py-10",children:"No Coupons Found"}),i&&e.jsx(M,{onClose:()=>p(!1),children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Confirm Delete"}),e.jsxs("p",{className:"mb-6",children:["Are you sure you want to delete the coupon ",u==null?void 0:u.name,"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]})})]})};export{P as default};
