import{H as de,I as P,r as d,g as G,k as ue,a as pe,K as me,j as e,A as he,_ as m}from"./main-DA-vLYwL.js";import{A as xe}from"./AddCouponCodeModal-Dm0dnx3k.js";import{g as ge}from"./index-QXBYaDF9.js";import{D as be}from"./Dropdown-CslC-zzG.js";import{C as fe}from"./CircularLoader-DpqCMVwK.js";import{A as ye}from"./arrow-left-CLRbmHMc.js";import"./Button-eyYpVHNH.js";import"./cn-DUyS5Z8L.js";import"./Modal-DmDqMwFG.js";import"./es.promise.resolve-BgbU4_Dm.js";import"./createLucideIcon-yfTUF5RS.js";const qe=()=>{var $;const[V]=de(),[D]=P(),[B,U]=d.useState([]),{username:J}=G(),K=J.replace("@",""),{data:j}=ue({username:K}),L=`cart_${($=j==null?void 0:j.data)==null?void 0:$.influencerId}`,[Q,N]=d.useState(!1),[h,R]=d.useState(null),[v,Y]=d.useState(0),[i,C]=d.useState(()=>{const t=localStorage.getItem(L);return t?JSON.parse(t):[]}),[A,z]=d.useState([]),H=pe();d.useEffect(()=>{localStorage.setItem(L,JSON.stringify(i)),z(i.map(t=>({productId:t._id,quantity:t.quantity,productType:t.productType||"physical"})))},[i]);const[W,{isLoading:X}]=me(),[g,k]=d.useState(!1),Z=async()=>{var t;if(!g){k(!0);try{const s=await W({products:A,name:r.name,email:r.email,phone:r.phoneNumber,address:{line1:r.addressLine1,line2:r.addressLine2,additionalInfo:r.additionalInstructions,city:r.city,state:r.state,postalCode:r.postalCode,country:r.country},couponCode:h==null?void 0:h.name});window.location.href=s.data.checkoutUrl}catch(s){console.error("Checkout Error:",s),m.error(((t=s.data)==null?void 0:t.message)||"Error creating checkout"),k(!1)}}},[r,T]=d.useState({name:"",email:"",addressLine1:"",addressLine2:"",additionalInstructions:"",city:"",state:"",postalCode:"",country:"",phoneNumber:""}),ee=t=>{C(s=>s.map(n=>n._id===t?{...n,quantity:n.quantity+1}:n))},te=t=>{C(s=>s.map(n=>n._id===t&&n.quantity>1?{...n,quantity:n.quantity-1}:n))},se=async t=>{var o,u,l;const s=i.filter(a=>a._id!==t);C(s);const{username:n}=G(),c=`cart_${n.replace("@","")}`;if(localStorage.setItem(c,JSON.stringify(s)),r.country)try{const a=await D({brandIds:s.map(y=>y.brandId),country:r.country});I({notDeliverable:((o=a==null?void 0:a.data)==null?void 0:o.notDeliverable)||[]});const S=F(s,((u=a==null?void 0:a.data)==null?void 0:u.shippingDetails)||[]);b(S),f(((l=a==null?void 0:a.data)==null?void 0:l.vat)||0)}catch(a){m.error("Error updating shipping costs"),console.error(a)}},w=i.reduce((t,s)=>t+s.pricing*s.quantity,0),[q,b]=d.useState(0),[E,f]=d.useState(0),ne=async t=>{try{const s=await V({couponCode:t,brandId:i[0].brandId});if("error"in s){m.error("Coupon not valid for this brand");return}const n=s.data.data;if(n){let c=i.reduce((u,l)=>u+l.pricing*l.quantity,0),o=0;if((n.applyTo.includes("SUBTOTAL")||n.applyTo.includes("DELIVERY"))&&(n.discount.type==="PERCENTAGE"?o=c*n.discount.amount/100:o=n.discount.amount),n.minimumOrderValue&&c<n.minimumOrderValue){m.error(`Coupon ${n.name} is not valid for this order. Minimum order value is €${n.minimumOrderValue}`);return}Y(o),R(n),N(!1),m.success(`Coupon applied successfully. Total discount: €${o.toFixed(2)}`)}}catch(s){m.error(s.message||"Error applying coupon")}},p=t=>{const{name:s,value:n}=t.target;T(c=>({...c,[s]:n}))},O=()=>!(re.notDeliverable.length>0)&&Object.entries(r).every(([s,n])=>s==="additionalInstructions"||s==="addressLine2"||s==="state"?!0:n.trim()!=="");d.useEffect(()=>{const t=ge();U(t)},[]);const ae=Object.entries(B).map(([t,s])=>s.name),[re,I]=d.useState({notDeliverable:[]}),oe=async t=>{var s,n,c,o,u;T(l=>({...l,country:t}));try{const l=i.filter(a=>a.productType==="physical");if(l.length>0){const a=await D({brandIds:l.map(y=>y.brandId),country:t});if(I({notDeliverable:((s=a==null?void 0:a.data)==null?void 0:s.notDeliverable)||[]}),((c=(n=a==null?void 0:a.data)==null?void 0:n.notDeliverable)==null?void 0:c.length)>0){const M=i.filter(x=>a.data.notDeliverable.includes(x.brandId)).filter(x=>x.productType==="physical").map(x=>x.title).join(", ");m.error(`${M} ${M.includes(",")?"are":"is"} not deliverable to ${t}`),b(0),f(0);return}const S=F(l,((o=a==null?void 0:a.data)==null?void 0:o.shippingDetails)||[]);b(S),f(((u=a==null?void 0:a.data)==null?void 0:u.vat)||0)}else b(0),f(0),I({notDeliverable:[]})}catch(l){m.error("Error fetching taxes"),console.error(l)}},F=(t,s)=>{const n=t.filter(o=>o.productType==="physical");if(n.length===0)return 0;let c=0;return n.forEach(o=>{const u=o.brandId,l=s.find(a=>a.brandId===u);if(l){const a=l.shippingCharges;c+=a}else console.log(`No shipping rules found for brand ${u}`)}),c},{data:je,isLoading:le}=P({brandIds:i.map(t=>t.brandId),country:r.country}),ie=w-(v||0),_=i.reduce((t,s)=>{if(s.productType==="physical"){const n=s.pricing*s.quantity,c=n/w*(v||0),o=n-c;return t+o*E}return t},0),ce=ie+_+(q||0);return console.log(A,"products"),le||X?e.jsx(he,{}):e.jsxs(e.Fragment,{children:[Q&&e.jsx(xe,{onClose:()=>N(!1),handleConfirmationModal:ne}),e.jsx("div",{className:"min-h-screen p-4 md:p-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("button",{onClick:()=>{H(-1)},className:"text-lg text-gray-600 font-bold mb-4",children:e.jsx(ye,{})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Your Shopping Cart"}),e.jsx("p",{className:"text-gray-500 mt-2",children:`${i.length} Items`}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between ",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"mt-6 w-full space-y-4",children:i==null?void 0:i.map(t=>{var s,n;return e.jsxs("div",{className:"flex flex-col  lg:flex-row justify-between bg-green-light p-4 rounded-lg space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:t.imageUrls[0],className:"w-16 h-16 bg-green-400 rounded-lg object-cover",alt:"product"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:((s=t.title)==null?void 0:s.trim().length)>30?t.title.trim().slice(0,30)+"...":(n=t.title)==null?void 0:n.trim()}),e.jsx("p",{className:"text-gray-500",children:t.brand})]}),e.jsxs("p",{className:"text-lg px-4 font-medium",children:["€",t.pricing]})]}),e.jsxs("div",{className:"flex items-center justify-between w-full md:w-auto space-x-2 md:space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>ee(t._id),className:"bg-white px-3 rounded-lg text-lg",children:"+"}),e.jsx("span",{className:"text-lg font-semibold",children:t.quantity.toString().padStart(2,"0")}),e.jsx("button",{onClick:()=>te(t._id),className:"bg-white px-3 rounded-lg text-lg",children:"−"})]}),e.jsxs("p",{className:"text-lg font-semibold",children:["€",(t.pricing*t.quantity).toFixed(2)]}),e.jsx("button",{onClick:()=>se(t._id),className:"text-red-600",children:e.jsx("img",{src:"/icons/deleteIcon.svg",alt:"delete",className:"w-6 h-6"})})]})]},t.id)})})," ",e.jsxs("div",{className:" mt-8 bg-green-light p-6 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Shipping Details"}),e.jsxs("form",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Name *"}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:p,className:"w-full px-3 py-2 border rounded-3xl  border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"Enter your name",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:p,className:"w-full px-3 py-2  rounded-3xl border border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"Enter your email",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Address"}),e.jsx("input",{type:"text",name:"addressLine1",value:r.addressLine1,onChange:p,className:"w-full px-3 py-2  rounded-3xl mb-2 border border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"Address Line 1",required:!0}),e.jsx("input",{type:"text",name:"addressLine2",value:r.addressLine2,onChange:p,className:"w-full px-3 py-2  rounded-3xl mb-2 border border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"Address Line 2 (optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",name:"city",value:r.city,onChange:p,className:"w-full px-3 py-2  rounded-3xl border border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"City",required:!0}),e.jsx("input",{type:"text",name:"state",value:r.state,onChange:p,className:"w-full px-3 py-2  rounded-3xl border border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"State (optional)",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("input",{type:"text",name:"postalCode",value:r.postalCode,onChange:p,className:"w-full px-3 py-2  rounded-3xl border border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"Postal Code",required:!0}),e.jsx(be,{options:ae,name:r.country,onChange:oe,value:r.country})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Phone Number *"}),e.jsx("input",{type:"tel",name:"phoneNumber",value:r.phoneNumber,onChange:p,className:"w-full px-3 py-2  rounded-3xl border border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"Enter your phone number",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:" Additional Instructions (optional)"}),e.jsx("input",{type:"text",name:"additionalInstructions",value:r.additionalInstructions,onChange:p,className:"w-full px-3 py-2 rounded-3xl mb-2 border border-green-light focus:border-green outline-none placeholder:text-sm",placeholder:"Additional Address Information (optional)"})]})]})]})]}),e.jsx("div",{className:"w-full lg:w-1/3 bg-white-pure h-fit p-6 rounded-lg mt-6  md:ml-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"font-bold text-lg",children:"SUBTOTAL"}),e.jsxs("p",{className:"font-semibold",children:["€",(w||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"font-light text-sm",children:"Shipping"}),e.jsxs("p",{className:"font-light",children:["€",q.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"font-light text-sm",children:"VAT"}),e.jsxs("p",{className:"font-light",children:["€",_.toFixed(2)," (",(E*100).toFixed(0),"%)"]})]}),h&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"font-bold text-lg",children:["Coupon (",h.name,")"]}),e.jsxs("p",{className:"font-semibold text-green-500",children:["−€",(v||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"font-bold text-lg",children:"TOTAL"}),e.jsx("p",{className:"font-semibold",children:ce.toFixed(2)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>N(!0),className:"text-green-500 font-semibold underline",children:"Apply Coupon"})}),e.jsx("button",{className:`w-full py-3 rounded-lg mt-4 text-lg flex justify-center items-center ${O()&&!g?"bg-green-500 text-white-pure":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:!O()||g,onClick:Z,children:g?e.jsx(fe,{size:"small",color:"white"}):e.jsxs(e.Fragment,{children:["Checkout",e.jsx("img",{src:"/icons/checkout.svg",alt:"checkout",className:"w-6 h-6 ml-2"})]})})]})})]})]})})]})};export{qe as default};
