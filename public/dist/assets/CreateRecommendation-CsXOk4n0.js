import{w as B,r,a as G,aH as H,a1 as J,as as V,j as e}from"./main-rkb-dHu5.js";import{C as z}from"./ConfirmationModal-B-6ZTl8X.js";import{Q as K,B as c}from"./ReactToastify-B5dD8n0G.js";import{R as W}from"./index-DuNlSBVo.js";/* empty css                   */import"./Button-CvMneL3o.js";import"./cn-DUyS5Z8L.js";import"./Modal-BCQBNMZ8.js";import"./CircularLoader-ByPKQ32Q.js";const ie=()=>{const{user:a}=B(t=>t.auth),[m,_]=r.useState(""),[y,S]=r.useState(""),[i,p]=r.useState([]),[d,N]=r.useState(null),[u,R]=r.useState(""),[q,f]=r.useState(!1),v=G(),[k]=H(),{data:b}=J(),{data:g}=V(),h=(b==null?void 0:b.data.map(t=>(t==null?void 0:t.productId)||t))||[],x=(g==null?void 0:g.products.map(t=>t))||[],[I,w]=r.useState(!1),C=r.useRef(null),D=async t=>{if(t.preventDefault(),!d){c.error("Thumbnail is required!");return}if(i.length===0){c.error("Please select at least one product!");return}if(!m){c.error("Title is required!");return}if(!u){c.error("Description is required!");return}f(!0)},E=async()=>{if(w(!0),!m||!u){c.error("Please fill all the fields!");return}const t=i.filter(s=>(a==null?void 0:a.accountType)==="influencer"?s.id:s._id);if(t.length===0){c.error("Please select at least one product!");return}try{const s=new FormData;s.append("title",m),s.append("content",u),s.append("tags",y.split(",").map(n=>n.trim())),s.append("products",JSON.stringify(t.map(n=>n.id||n._id))),d&&s.append("thumbnail",d),await k(s),c.success("Recommendation created successfully!"),v((a==null?void 0:a.accountType)==="brand"?"/brands/recommendations":"/recommendations")}catch(s){c.error("Error creating recommendation"),console.error(s)}finally{f(!1),w(!1)}},A=t=>{R(t)},U=(t,s,n)=>{var P,T;const l=[...i];if(s==="id"||s==="_id"){const o=(a==null?void 0:a.accountType)==="influencer"?h.find(j=>j._id===n):x.find(j=>j._id===n);o&&((a==null?void 0:a.accountType)==="influencer"?l[t]={id:o._id,title:o.title,price:parseInt(o.pricing),quantity:((P=l[t])==null?void 0:P.quantity)||1}:l[t]={_id:o._id,title:o.title,pricing:parseInt(o.pricing),quantity:((T=l[t])==null?void 0:T.quantity)||1})}else s==="quantity"&&(l[t]={...l[t],quantity:parseInt(n)});console.log(l,"updatedProducts"),p(l)},F=()=>{p([...i,(a==null?void 0:a.accountType)==="influencer"?{id:"",title:"",price:0,quantity:1}:{_id:"",title:"",pricing:0,quantity:1}])};console.log(i,"selectedProducts");const M=t=>{t.target.files[0]&&N(t.target.files[0])},O=()=>{N(null),C.current.value=""},Q=i.reduce((t,s)=>t+((a==null?void 0:a.accountType)==="influencer"?s.price:s.pricing)*s.quantity,0),L=t=>{p(i.filter((s,n)=>n!==t))};return console.log(h,"products"),console.log(x,"brandProducts"),e.jsxs("form",{onSubmit:D,children:[q&&e.jsx(z,{onClose:()=>f(!1),handleConfirm:E,title:"Confirmation",loading:I,description:"Are you sure you want to publish this recommendation?"}),e.jsx(K,{}),e.jsxs("div",{className:"p-6 min-h-screen",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("button",{className:"mr-4",onClick:()=>v(-1),children:e.jsx("img",{src:"/icons/back_button.svg",alt:"back"})}),e.jsx("h1",{className:"text-3xl font-bold py-2",children:"Create Recommendation"})]}),e.jsxs("div",{className:"flex lg:flex-row flex-col lg:justify-between items-start mb-6",children:[e.jsxs("div",{className:"lg:w-2/3 ",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"Title of the recommendation",value:m,onChange:t=>_(t.target.value),className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4"}),e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"",children:e.jsx(W,{theme:"snow",value:u,onChange:A,placeholder:"Start typing..."})})]}),e.jsx("div",{className:"lg:w-1/4 w-1/2 flex pt-8 justify-end",children:e.jsxs("div",{className:"bg-[#E4FFF0] rounded-lg p-4 w-full",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Products Added ",e.jsx("span",{className:"text-red-500",children:"*"})]}),i.map((t,s)=>e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"break-words truncate hover:text-clip hover:whitespace-normal",children:t.title}),e.jsxs("span",{children:[t==null?void 0:t.pricing," x ",t==null?void 0:t.quantity]})]},s)),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[Q||0,"€"]})]})]})})]}),e.jsxs("div",{className:"md:w-2/3 w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Thumbnail ",e.jsx("span",{className:"text-red-500",children:"*"})]}),d?e.jsx("button",{type:"button",className:"text-red text-base font-semibold underline",onClick:O,children:"- REMOVE"}):e.jsxs("label",{htmlFor:"productImage",className:"text-green text-base font-semibold underline cursor-pointer",children:["+ UPLOAD",e.jsx("input",{ref:C,id:"productImage",type:"file",name:"productImage",accept:"image/*",className:"hidden",onChange:M})]})]}),d&&e.jsx("div",{className:"ml-4 mt-2",children:e.jsx("img",{src:URL.createObjectURL(d),alt:"Thumbnail Preview",className:"w-16 h-16 object-cover rounded-lg"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tags"}),e.jsx("input",{type:"text",placeholder:"Add respective tags (comma separated)",value:y,onChange:t=>S(t.target.value),className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("button",{type:"button",onClick:F,className:"text-green-500",children:"+ ADD"})]}),i.map((t,s)=>e.jsx("div",{className:"grid grid-cols-2 gap-4 mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:(a==null?void 0:a.accountType)==="influencer"?t.id:t._id,onChange:n=>U(s,(a==null?void 0:a.accountType)==="influencer"?"id":"_id",n.target.value),className:"block w-full bg-white-pure border border-green-100 rounded-3xl px-4 py-2 mb-4",children:[e.jsx("option",{value:"",children:"Pick a product"}),h.length>0?h.map(n=>e.jsx("option",{value:n==null?void 0:n._id,children:n==null?void 0:n.title},n==null?void 0:n._id)):x.length>0?x.map(n=>e.jsx("option",{value:n._id,children:n.title},n._id)):e.jsx("option",{value:"",children:"No products found"})]}),e.jsx("button",{type:"button",onClick:()=>L(s),className:"absolute right-[-30px] top-2 text-red-500 hover:text-red-700",children:"✕"})]})},s))]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"bg-green-500 text-white-pure rounded-3xl px-4 py-2",children:"Publish"})})]})]})]})};export{ie as default};
