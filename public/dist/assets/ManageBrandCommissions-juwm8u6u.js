import{a as W,ba as X,r as o,bb as Y,bc as Z,j as t,A as ee,av as f}from"./main-rkb-dHu5.js";import{M as te}from"./Modal-_2ayBxly.js";import{E as se,a as ae}from"./jspdf.plugin.autotable-Co_xyDD4.js";import{s as le}from"./search-ARtRfbrc.js";import{C as re}from"./ConfirmationModal-B-6ZTl8X.js";import{E as de}from"./eye-y4_ED_9k.js";import{T as I}from"./trash-2-DjpvhiVs.js";import"./render-BxJVqWkM.js";import"./x-6k1wTkVV.js";import"./createLucideIcon-Rsg1P1ng.js";import"./typeof-QjJsDpFa.js";import"./Button-CvMneL3o.js";import"./cn-DUyS5Z8L.js";import"./Modal-BCQBNMZ8.js";import"./CircularLoader-ByPKQ32Q.js";function we(){var v,C;const S=W(),{data:m,isLoading:F,refetch:j}=X(),[x,A]=o.useState(""),[c,E]=o.useState(""),[p,L]=o.useState([]);o.useState([]),o.useState(!1);const[g,R]=o.useState(""),[k,N]=o.useState(!1),[h,T]=o.useState(null),[_,{isLoading:M}]=Y(),[P,{isLoading:O}]=Z(),[y,b]=o.useState(!1),[V,w]=o.useState(null);o.useEffect(()=>{m&&$(),j()},[m,x,c]);const $=()=>{let e=[...m||[]];x&&(e=e.filter(s=>{var a;return s._id.toLowerCase().includes(x.toLowerCase())||((a=s.productId)==null?void 0:a.title.toLowerCase().includes(x.toLowerCase()))})),c==="price-low-to-high"?e.sort((s,a)=>parseFloat(s.productId.pricing)-parseFloat(a.productId.pricing)):c==="price-high-to-low"?e.sort((s,a)=>parseFloat(a.productId.pricing)-parseFloat(s.productId.pricing)):c==="alphabetical"?e.sort((s,a)=>s.productId.title.localeCompare(a.productId.title)):c==="date"&&e.sort((s,a)=>new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime()),L(e)},B=e=>A(e.target.value),H=e=>E(e.target.value),U=()=>{g==="pdf"?G():g==="csv"&&Q()},G=()=>{const e=new se,s=[];p.forEach(a=>{var n;(n=a.recipients)==null||n.forEach(r=>{var d,l;s.push([a._id,(d=a.productId)==null?void 0:d.title,((l=r.userId)==null?void 0:l.fullName)||"No Recipient",`${r.percentage}%`,new Date(a.createdAt).toLocaleDateString()])})}),ae(e,{head:[["Commission ID","Product","Influencer","Percentage","Date"]],body:s}),e.save("commissions.pdf")},Q=()=>{const e=[["Commission ID","Product","Influencer","Percentage","Date"]];p.forEach(d=>{var l;(l=d.recipients)==null||l.forEach(i=>{var u;e.push([d._id,d.productId.title,((u=i.userId)==null?void 0:u.fullName)||"No Recipient",`${i.percentage}%`,new Date(d.createdAt).toLocaleDateString()])})});const s=e.map(d=>d.join(",")).join(`
`),a=new Blob([s],{type:"text/csv"}),n=window.URL.createObjectURL(a),r=document.createElement("a");r.setAttribute("hidden",""),r.setAttribute("href",n),r.setAttribute("download","commissions.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},q=e=>{const s=p.find(a=>a._id===e);T(s),N(!0)},z=async e=>{w(e),b(!0)},J=async()=>{var e;try{await P(V).unwrap(),j(),f.success("Commission deleted successfully")}catch(s){f.error(((e=s==null?void 0:s.data)==null?void 0:e.message)||"Failed to delete commission")}finally{b(!1),w(null)}},K=async(e,s)=>{var a;try{await _({commissionId:e,userId:s}).unwrap(),f.success("Recipient deleted successfully"),window.location.reload()}catch(n){f.error(((a=n==null?void 0:n.data)==null?void 0:a.message)||"Failed to delete recipient")}};return M||O?t.jsx(ee,{}):t.jsxs("div",{className:"p-6 bg-[#f5fffa] min-h-screen",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Manage Commissions"}),t.jsx("button",{onClick:()=>S("/brands/add-commission"),className:"bg-green-500 text-white rounded-3xl px-4 py-2",children:"Add commission"})]}),t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("div",{className:"relative min-h-10 min-w-[400px]",children:[t.jsx("img",{src:le,alt:"Search Icon",className:"w-4 absolute left-3 top-1/2 transform -translate-y-1/2"}),t.jsx("input",{type:"text",placeholder:"Search for commissions",value:x,onChange:B,className:"w-full py-2 pl-10 pr-4 rounded-3xl border border-[#E4FFF0] font-normal text-sm focus:outline-none focus:ring-2 focus:ring-white"})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("select",{value:c,onChange:H,className:"p-2 border border-[#E4FFF0] font-medium text-sm rounded-3xl focus:outline-none focus:ring-2 focus:ring-white",children:[t.jsx("option",{value:"",children:"Filter Commissions"}),t.jsx("option",{value:"price-low-to-high",children:"Price: Low to High"}),t.jsx("option",{value:"price-high-to-low",children:"Price: High to Low"}),t.jsx("option",{value:"alphabetical",children:"Alphabetical"}),t.jsx("option",{value:"date",children:"Date"})]}),t.jsxs("select",{value:g,onChange:e=>R(e.target.value),className:"p-2 border border-[#E4FFF0] font-medium text-sm rounded-3xl focus:outline-none focus:ring-2 focus:ring-white",children:[t.jsx("option",{value:"",children:"Export"}),t.jsx("option",{value:"pdf",children:"Export as PDF"}),t.jsx("option",{value:"csv",children:"Export as CSV"})]}),t.jsx("button",{onClick:U,className:"px-4 py-2 bg-green-500 font-medium text-sm text-white rounded-3xl",children:"Apply"})]})]}),t.jsx("div",{className:"overflow-x-auto",children:F?t.jsx("p",{className:"text-center text-gray-500",children:"Loading commissions..."}):p.length===0?t.jsx("p",{className:"text-center text-gray-500",children:"No commissions found"}):t.jsxs("table",{className:"min-w-full bg-white",children:[t.jsx("thead",{className:"border-b-2 border-gray-600",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Influencer"}),t.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Percentage"}),t.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-left text-sm leading-4 text-gray-600 tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{children:p.map(e=>{var s,a,n,r,d;return t.jsxs("tr",{className:"hover:bg-gray-100 bg-[#f5fffa]",children:[t.jsxs("td",{className:"px-6 py-4 border-b border-gray-200",children:[t.jsx("p",{className:"font-bold pb-1 text-base",children:(s=e==null?void 0:e.productId)==null?void 0:s.title}),t.jsx("p",{className:"text-xs",children:(a=e==null?void 0:e.productId)==null?void 0:a._id}),t.jsxs("p",{className:"text-sm",children:[(n=e==null?void 0:e.productId)==null?void 0:n.pricing,"â‚¬"]})]}),t.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:(r=e==null?void 0:e.recipients)==null?void 0:r.map((l,i)=>{var u,D;return t.jsxs("div",{className:"mb-2 last:mb-0",children:[t.jsx("p",{className:"font-bold pb-1 text-base",children:((u=l==null?void 0:l.userId)==null?void 0:u.fullName)||"No Recipient"}),t.jsx("p",{className:"text-xs",children:((D=l==null?void 0:l.userId)==null?void 0:D._id)||"N/A"})]},i)})}),t.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:(d=e==null?void 0:e.recipients)==null?void 0:d.map((l,i)=>t.jsxs("div",{className:"mb-2 last:mb-0",children:[l==null?void 0:l.percentage,"%"]},i))}),t.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${e!=null&&e.isDeleted?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:e!=null&&e.isDeleted?"Deleted":"Active"})}),t.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:new Date(e==null?void 0:e.createdAt).toLocaleDateString()}),t.jsx("td",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>q(e._id),className:"p-2 text-blue-600 hover:text-blue-800",title:"View Influencers",children:t.jsx(de,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>z(e==null?void 0:e._id),className:"p-2 text-red-600 hover:text-red-800",title:"Delete Commission",children:t.jsx(I,{className:"h-5 w-5"})})]})})]},e==null?void 0:e._id)})})]})}),y&&t.jsx(re,{onClose:()=>b(!1),handleConfirm:J,title:"Delete Commission",description:"Are you sure you want to delete this commission? This action cannot be undone.",isOpen:y}),t.jsx(te,{isOpen:k,onClose:()=>N(!1),title:"Commission Details",children:h&&t.jsxs("div",{className:"p-4",children:[t.jsxs("h3",{className:"font-bold text-lg mb-4",children:[t.jsx("span",{className:"font-normal text-sm",children:"Product Name:"})," ",(v=h.productId)==null?void 0:v.title]}),t.jsx("div",{className:"space-y-4",children:(C=h.recipients)==null?void 0:C.map(e=>{var s;return t.jsxs("div",{className:"p-4 flex justify-between bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-col justify-between items-center",children:[t.jsx("p",{className:"font-semibold",children:((s=e.userId)==null?void 0:s.fullName)||"No Recipient"}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Commission: ",e.percentage,"%"]})]}),t.jsx("button",{onClick:()=>K(h._id,e.userId._id),className:"p-2 text-red-600 hover:text-red-800",title:"Delete Recipient",children:t.jsx(I,{className:"h-5 w-5"})})]},e==null?void 0:e._id)})})]})})]})}export{we as default};
