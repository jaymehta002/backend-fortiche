import{a as B,as as E,b1 as F,bd as M,r as l,j as e,A as z,av as c}from"./main-17S3Hvul.js";import{D as v}from"./Dropdown-XAuyzZwj.js";import{B as u}from"./Button-D9xH6dL9.js";import{I as G}from"./Input-DVQunyol.js";import{A as O}from"./arrow-left-Bjrxd5xc.js";import{P as Q}from"./plus-DFCC9yGE.js";import{T as R}from"./trash-2-CT0zYae0.js";import"./cn-DUyS5Z8L.js";import"./createLucideIcon-DUHjy5LS.js";function X(){var j,y;const h=B(),{data:a,isLoading:p}=E(),{data:o,isLoading:x}=F(),[I,{isLoading:d}]=M(),[f,w]=l.useState(""),[m,g]=l.useState(""),[r,b]=l.useState(""),[i,N]=l.useState([]),C=l.useMemo(()=>{var n;const s={};return(n=a==null?void 0:a.products)==null||n.forEach(t=>{s[t.title]=t._id}),s},[a]),S=l.useMemo(()=>{var n;const s={};return(n=o==null?void 0:o.data)==null||n.forEach(t=>{s[t.fullName]=t._id}),s},[o]),A=((j=a==null?void 0:a.products)==null?void 0:j.map(s=>`${s.title}`))||[],P=((y=o==null?void 0:o.data)==null?void 0:y.map(s=>`${s.fullName}`))||[],T=()=>{if(!m){c.error("Please select an influencer");return}if(!r||isNaN(r)||r<=0||r>100){c.error("Please enter a valid commission between 0 and 100");return}const s={influencerId:S[m],influencerName:m,commission:r};N([...i,s]),g(""),b("")},k=s=>{const n=[...i];n.splice(s,1),N(n)},L=async s=>{var n;if(s.preventDefault(),!f){c.error("Please select a product");return}if(i.length===0){c.error("Please add at least one influencer");return}try{await I({productId:C[f],recipients:i.map(t=>({userId:t.influencerId,amount:parseFloat(t.commission)}))}).unwrap(),c.success("Commissions added successfully!"),h("/brands/manage-commissions")}catch(t){c.error(((n=t==null?void 0:t.data)==null?void 0:n.message)||"Failed to add commissions")}};return d||p||x?e.jsx(z,{}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs(u,{variant:"ghost",className:"mb-6 flex items-center text-gray-600 hover:text-gray-800",onClick:()=>h("/brands/manage-commissions"),disabled:d,children:[e.jsx(O,{className:"mr-2 h-4 w-4"})," Back to Commissions"]}),e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Add Commission"}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2 relative z-30",children:[e.jsx("label",{htmlFor:"product",className:"block text-sm font-medium text-gray-700",children:"Select Product"}),e.jsx(v,{id:"product",className:"w-full",options:A,onChange:w,name:f,placeholder:"Select Product",disabled:p})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Add Influencers"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2 relative z-20",children:[e.jsx("label",{htmlFor:"influencer",className:"block text-sm font-medium text-gray-700",children:"Select Influencer"}),e.jsx(v,{id:"influencer",className:"w-full",options:P,onChange:g,name:m,placeholder:"Select Influencer",disabled:x})]}),e.jsxs("div",{className:"space-y-2 relative z-10",children:[e.jsx("label",{htmlFor:"commission",className:"block text-sm font-medium text-gray-700",children:"Commission Amount (%)"}),e.jsx(G,{id:"commission",type:"number",value:r,onChange:s=>{const n=Math.min(100,Math.max(0,s.target.valueAsNumber||0));b(n.toString())},className:"w-full",placeholder:"Enter commission percentage",min:"0",max:"100",step:"0.01"})]})]}),e.jsxs(u,{type:"button",variant:"secondary",onClick:T,className:"w-full text-green border-green font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out flex items-center justify-center",disabled:!m||!r,children:[e.jsx(Q,{className:"mr-2 h-4 w-4"})," Add Influencer"]})]}),i.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Selected Influencers"}),e.jsx("ul",{className:"space-y-2",children:i.map((s,n)=>e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-md",children:[e.jsxs("span",{children:[s.influencerName," - ",s.commission,"%"]}),e.jsx(u,{type:"button",onClick:()=>k(n),className:"text-red-500 hover:text-red-700",children:e.jsx(R,{className:"h-4 w-4"})})]},n))})]}),e.jsx("div",{className:"pt-4",children:e.jsx(u,{type:"submit",className:"w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md transition duration-150 ease-in-out",disabled:d||p||x,children:d?"Saving...":"Save and Continue"})})]})]})})}export{X as default};
